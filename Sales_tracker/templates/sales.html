<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sales Tracker Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
	{% from 'bootstrap5/form.html' import render_form %}
</head>
<body>
<div class="container">

			<header class="header">

				<nav class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom" >
					<a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
						<span class="fs-4">Sales Tracker App</span>
					</a>
					<ul class="nav nav-pills">
						<li class="nav-item">
							<a href="/" class="nav-link active" aria-current="page">Logout</a>
						</li>
					</ul>

				</nav>

			</header>
			<div class="p-2 mb-4 bg-light rounded-3">
				<div class="text-center">
					<h1 class="display-5 fw-bold">Sales Tracker Page</h1>
					<p>
						<a class="btn btn-lg btn-success" href="/users/" role="button">Users</a>
                        <a class="btn btn-lg btn-success" href="/database/" role="button">Database</a>
                        <a class="btn btn-lg btn-success" href="/targets/" role="button">Targets</a>
                        <a class="btn btn-lg btn-success" href="/sales/" role="button">Sales Tracker</a>
					</p>
				</div>
			</div>
			<div id="sales_form" class="p-2 mb-4 bg-light rounded-3">
				{{ render_form(sales_form) }}
			<script>
				device_select = document.getElementById("select_device")
				data_select = document.getElementById("select_data")
				length_select = document.getElementById("select_length")
				price_select = document.getElementById("select_price")
				device_select.onchange = function(){
					device_val = device_select.value
					data_val = data_select.value
					length_val = length_select.value
					price_val = price_select.value
					fetch('/_updatesalesdrop', {
						headers : {
							'Content-Type' : 'application/json'
						},
						method : 'POST',
						body : JSON.stringify( {
							'device' : device_val,
							'data' : data_val,
							'length' : length_val,
							'price' : price_val
						})
					}).then(function(response) {
						response.json().then(function(data) {
							options = '<option value></option>';
							for (data_amount of data["data"]) {
								options += '<option value="' + data_amount + '">' + data_amount + '</option>';
							}
							select_data.innerHTML = options;
							data_select.value = data_val
							options = '<option value></option>';
							for (length of data["length"]) {
								options += '<option value="' + length + '">' + length + '</option>';
							}
							select_length.innerHTML = options;
							length_select.value = length_val
							options = '<option value></option>';
							for (price of data["price"]) {
								options += '<option value="' + price + '">' + price + '</option>';
							}
							select_price.innerHTML = options;
							price_select.value = price_val
							if (device_val == "") {
								options = '<option value></option>';
								for (device of data["device"]) {
								options += '<option value="' + device + '">' + device + '</option>';
								}
								select_device.innerHTML = options;
							}
						});
					});
				}
				data_select.onchange = function(){
					device_val = device_select.value
					data_val = data_select.value
					length_val = length_select.value
					price_val = price_select.value
					fetch('/_updatesalesdrop', {
						headers : {
							'Content-Type' : 'application/json'
						},
						method : 'POST',
						body : JSON.stringify( {
							'device' : device_val,
							'data' : data_val,
							'length' : length_val,
							'price' : price_val
						})
					}).then(function(response) {
						response.json().then(function(data) {
							options = '<option value></option>';
							for (device of data["device"]) {
								options += '<option value="' + device + '">' + device + '</option>';
							}
							select_device.innerHTML = options;
							device_select.value = device_val
							options = '<option value></option>';
							for (length of data["length"]) {
								options += '<option value="' + length + '">' + length + '</option>';
							}
							select_length.innerHTML = options;
							length_select.value = length_val
							options = '<option value></option>';
							for (price of data["price"]) {
								options += '<option value="' + price + '">' + price + '</option>';
							}
							select_price.innerHTML = options;
							price_select.value = price_val
							if (data_val == "") {
								options = '<option value></option>';
								for (data_amount of data["data"]) {
								options += '<option value="' + data_amount + '">' + data_amount + '</option>';
								}
								select_data.innerHTML = options;
							}
						});
					});
				}

				length_select.onchange = function(){
					device_val = device_select.value
					data_val = data_select.value
					length_val = length_select.value
					price_val = price_select.value
					fetch('/_updatesalesdrop', {
						headers : {
							'Content-Type' : 'application/json'
						},
						method : 'POST',
						body : JSON.stringify( {
							'device' : device_val,
							'data' : data_val,
							'length' : length_val,
							'price' : price_val
						})
					}).then(function(response) {
						response.json().then(function(data) {
							options = '<option value></option>';
							for (device of data["device"]) {
								options += '<option value="' + device + '">' + device + '</option>';
							}
							select_device.innerHTML = options;
							device_select.value = device_val
							options = '<option value></option>';
							for (data_amount of data["data"]) {
								options += '<option value="' + data_amount + '">' + data_amount + '</option>';
							}
							select_data.innerHTML = options;
							options = '<option value></option>';
							for (price of data["price"]) {
								options += '<option value="' + price + '">' + price + '</option>';
							}
							select_price.innerHTML = options;
							price_select.value = price_val
							data_select.value = data_val
							if (length_val == "") {
								options = '<option value></option>';
								for (length of data["length"]) {
								options += '<option value="' + length + '">' + length + '</option>';
								}
								select_length.innerHTML = options;
							}
						});
					});
				}

				price_select.onchange = function(){
					device_val = device_select.value
					data_val = data_select.value
					length_val = length_select.value
					price_val = price_select.value
					fetch('/_updatesalesdrop', {
						headers : {
							'Content-Type' : 'application/json'
						},
						method : 'POST',
						body : JSON.stringify( {
							'device' : device_val,
							'data' : data_val,
							'length' : length_val,
							'price' : price_val
						})
					}).then(function(response) {
						response.json().then(function(data) {
							options = '<option value></option>';
							for (device of data["device"]) {
								options += '<option value="' + device + '">' + device + '</option>';
							}
							select_device.innerHTML = options;
							options = '<option value></option>';
							device_select.value = device_val
							for (data_amount of data["data"]) {
								options += '<option value="' + data_amount + '">' + data_amount + '</option>';
							}
							select_data.innerHTML = options;
							options = '<option value></option>';
							for (length of data["length"]) {
								options += '<option value="' + length + '">' + length + '</option>';
							}
							select_length.innerHTML = options;
							length_select.value = length_val
							data_select.value = data_val
							if (price_val == "") {
								options = '<option value></option>';
								for (price of data["price"]) {
								options += '<option value="' + price + '">' + price + '</option>';
								}
								select_price.innerHTML = options;
							}
						});
					});
				}
			</script>
			</div>
			<div id="sales_list" class="p-2 mb-4 bg-light rounded-3">
				<p>LIST OF ALL SALES IN DATABASE</p>
				<table id="data" class="table table-striped">
					<thead>
					  <tr>
						<th>Username</th>
						<th>New</th>
						<th>Device</th>
						<th>Data</th>
						<th>Contract Length</th>
						<th>Price</th>
						<th>Revenue</th>
						<th>Commission</th>
						<th>Discount</th>
						<th>Insurance</th>
					  </tr>
					</thead>
					<tbody>
					  {% for sale in all_sales %}
						<tr>
						  <td>{{ sale.users.username }}</td>
						  <td>{{ sale.new }}</td>
						  <td>{{ sale.product.device }}</td>
						  <td>{{ sale.product.data }}GB</td>
						  <td>{{ sale.product.length }} months</td>
						  <td>£{{ sale.product.price|round(2) }}</td>
						  <td>£{{ sale.product.revenue|round(2) }}</td>
						  <td>£{{ sale.product.commission|round(2) }}</td>
						  <td>{{ sale.discount }}</td>
						  <td>{{ sale.insurance }}</td>
						</tr>
					  {% endfor %}
					</tbody>
			  	</table>
			</div>
			<footer class="footer">

				<p>&copy; Kenny Harvey 2023</p>

			</footer>

		</div>
</body>
</html>